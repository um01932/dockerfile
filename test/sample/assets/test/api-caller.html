<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>API TEST</title>
    <script type="text/javascript" src="/workplace-api/es6-promise.js"></script>
    <script type="text/javascript" src="/workplace-api/workplace-api.js"></script>
</head>
<body>
<script>
    //store connections for console access
    var connections = {};
    if (Messaging.isWorkplaceEnv()) {
        Messaging.getClient().then(function (client) {
            client.callApi('openApp', 'api-logger').then(function (id) {

                console.log('Application ' + id + ' has been opened.');

                // establish a message channel to currently opened instance
                return client.callApi('connect', {id: id}).then(function (connection) {

                    // Message Channel has been created
                    connections[id] = connection;

                    connection.onClose(function () {

                        // Application has been closed...
                        console.log('Application ' + id + ' has been closed.');

                    });

                    // Call an API function that appB has registered on the connection
                    return connection.callApi('log', {propertyA: 'valueA', propertyB: 'valueB'});

                });
            });
        }).catch(function (reason) {
            console.error(reason);
        });
    }
</script>
</body>
</html>
